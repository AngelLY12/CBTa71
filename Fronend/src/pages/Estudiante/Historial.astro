---
import StudentLayout from '../../layouts/LayoutEstu.astro';

const alumnoBackend = "Pedro Gonzalez Lopez";
const title = "Historial de Pagos";

// Simulamos datos agrupados o por fecha
const historialPagos = [
  { id: 1, concepto: "Colegiatura Semestre II - 2024", monto: "1,218.00", fecha: "15 Nov, 2024", metodo: "Visa • 4242", folio: "PAY-99283", categoria: "Académico" },
  { id: 2, concepto: "Examen Extraordinario", monto: "350.00", fecha: "02 Oct, 2024", metodo: "Efectivo/Ref", folio: "PAY-88122", categoria: "Trámite" },
  { id: 3, concepto: "Seguro Estudiantil Anual", monto: "85.00", fecha: "05 Sep, 2024", metodo: "Mastercard • 8812", folio: "PAY-77612", categoria: "Servicios" }
];
---

<StudentLayout title={title}>
  <div class="page-wrapper">
    
    <header class="history-header">
      <div class="header-main">
        <div class="title-group">
          <p class="pre-title">Gestión Financiera</p>
          <h1>Mi Historial</h1>
        </div>
        <div class="user-pill">
          <div class="avatar-mini">PG</div>
          <span>{alumnoBackend}</span>
        </div>
      </div>

      <div class="filter-bar">
        <div class="search-box">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
          <input type="text" placeholder="Buscar por concepto o folio...">
        </div>
      </div>
    </header>

    <main class="history-content">
      {historialPagos.length === 0 ? (
        <div class="empty-state">
          <div class="empty-icon-wrapper">
             <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
          </div>
          <h3>Todo al día</h3>
          <p>Aún no tienes movimientos registrados en tu historial.</p>
        </div>
      ) : (
        <div class="timeline">
          {historialPagos.map((pago) => (
            <div class="timeline-item">
              <div class="timeline-dot-wrapper">
                <div class="timeline-dot"></div>
                <div class="timeline-line"></div>
              </div>

              <div class="payment-card">
                <div class="payment-info">
                  <div class="category-tag">{pago.categoria}</div>
                  <h3>{pago.concepto}</h3>
                  <div class="payment-meta">
                    <span>{pago.fecha}</span>
                    <span class="separator">•</span>
                    <span class="folio">ID: {pago.folio}</span>
                  </div>
                  <div class="method-pill">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                    {pago.metodo}
                  </div>
                </div>

                <div class="payment-action">
                  <div class="amount-group">
                    <span class="currency">$</span>
                    <span class="amount">{pago.monto.split('.')[0]}</span>
                    <span class="decimals">.{pago.monto.split('.')[1]}</span>
                  </div>
                  <button class="download-btn" onclick="alert('Descargando comprobante...')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                    <span>Recibo</span>
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}
    </main>
  </div>
</StudentLayout>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');

  :root {
    --primary: #112d26;
    --accent: #c4a47c;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --bg-page: #f8fafc;
    --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
  }

  .page-wrapper {
    max-width: 750px;
    margin: 0 auto;
    padding: 2.5rem 1.25rem;
    font-family: 'Plus Jakarta Sans', sans-serif;
    background-color: var(--bg-page);
    min-height: 100vh;
  }

  /* --- HEADER --- */
  .history-header { margin-bottom: 2.5rem; }
  .header-main { 
    display: flex; 
    justify-content: space-between; 
    align-items: flex-end; 
    margin-bottom: 1.5rem; 
  }
  .pre-title { color: var(--accent); font-weight: 800; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 4px; }
  .header-main h1 { margin: 0; font-size: 2rem; font-weight: 800; color: var(--primary); letter-spacing: -1px; }

  .user-pill {
    background: white; padding: 6px 12px; border-radius: 100px; display: flex; align-items: center; gap: 10px;
    box-shadow: var(--card-shadow); border: 1px solid #f1f5f9; font-size: 0.85rem; font-weight: 700; color: var(--primary);
  }
  .avatar-mini { width: 28px; height: 28px; background: var(--primary); color: white; border-radius: 50%; display: grid; place-items: center; font-size: 0.7rem; }

  .filter-bar { background: white; border-radius: 16px; padding: 6px; box-shadow: var(--card-shadow); border: 1px solid #f1f5f9; }
  .search-box { display: flex; align-items: center; gap: 10px; padding: 8px 12px; color: var(--text-muted); }
  .search-box input { border: none; width: 100%; font-family: inherit; font-size: 0.9rem; font-weight: 500; outline: none; }

  /* --- TIMELINE & CARDS --- */
  .timeline { position: relative; padding-left: 20px; }
  .timeline-item { position: relative; display: flex; gap: 20px; margin-bottom: 20px; }

  .timeline-dot-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; }
  .timeline-dot { width: 12px; height: 12px; background: var(--accent); border-radius: 50%; z-index: 2; margin-top: 25px; box-shadow: 0 0 0 4px #f1f5f9; }
  .timeline-line { position: absolute; top: 30px; bottom: -30px; width: 2px; background: #e2e8f0; }
  .timeline-item:last-child .timeline-line { display: none; }

  .payment-card {
    background: white; border-radius: 24px; padding: 20px; flex: 1;
    display: flex; justify-content: space-between; align-items: center;
    box-shadow: var(--card-shadow); border: 1px solid transparent; transition: 0.3s;
  }
  .payment-card:hover { transform: scale(1.02); border-color: var(--accent); }

  .category-tag { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; color: var(--accent); margin-bottom: 6px; }
  .payment-info h3 { margin: 0; font-size: 1.1rem; font-weight: 700; color: var(--primary); }
  .payment-meta { font-size: 0.8rem; color: var(--text-muted); margin: 4px 0 10px; font-weight: 500; }
  .method-pill { 
    display: inline-flex; align-items: center; gap: 6px; background: #f8fafc; 
    padding: 4px 10px; border-radius: 8px; font-size: 0.75rem; color: var(--primary); font-weight: 700;
  }

  .payment-action { text-align: right; display: flex; flex-direction: column; gap: 12px; }
  .amount-group { color: var(--primary); font-weight: 800; }
  .currency { font-size: 0.9rem; vertical-align: top; margin-right: 2px; }
  .amount { font-size: 1.6rem; }
  .decimals { font-size: 0.9rem; opacity: 0.6; }

  .download-btn {
    background: var(--primary); color: white; border: none; padding: 8px 16px; 
    border-radius: 12px; font-weight: 700; font-size: 0.8rem; display: flex; 
    align-items: center; gap: 8px; cursor: pointer; transition: 0.2s;
  }
  .download-btn:active { transform: scale(0.95); }

  /* --- EMPTY STATE --- */
  .empty-state { text-align: center; padding: 4rem 2rem; color: var(--text-muted); }
  .empty-icon-wrapper { width: 80px; height: 80px; background: white; border-radius: 50%; display: grid; place-items: center; margin: 0 auto 1.5rem; color: #cbd5e1; box-shadow: var(--card-shadow); }

  /* --- RESPONSIVE MÓVIL --- */
  @media (max-width: 768px) {
    .page-wrapper {
      max-width: none;
      margin: 0;
      padding: 1rem 0.5rem;
    }
    .header-main { flex-direction: column; align-items: flex-start; gap: 15px; }
    .pre-title { font-size: 0.6rem; }
    .header-main h1 { font-size: 1.8rem; }
    .user-pill { font-size: 0.8rem; padding: 5px 10px; }
    .avatar-mini { width: 24px; height: 24px; font-size: 0.6rem; }
    .filter-bar { border-radius: 12px; padding: 4px; }
    .search-box { padding: 6px 10px; font-size: 0.85rem; }
    .search-box input { font-size: 0.85rem; }
    .timeline { padding-left: 15px; }
    .timeline-dot { width: 10px; height: 10px; margin-top: 20px; box-shadow: 0 0 0 3px #f1f5f9; }
    .timeline-line { top: 25px; width: 1px; }
    .payment-card { padding: 16px; border-radius: 20px; flex-direction: column; align-items: flex-start; gap: 15px; }
    .category-tag { font-size: 0.6rem; }
    .payment-info h3 { font-size: 1rem; }
    .payment-meta { font-size: 0.75rem; margin: 2px 0 8px; }
    .method-pill { font-size: 0.7rem; padding: 3px 8px; }
    .payment-action { width: 100%; flex-direction: row; justify-content: space-between; align-items: center; border-top: 1px solid #f1f5f9; padding-top: 12px; }
    .amount { font-size: 1.3rem; }
    .decimals { font-size: 0.8rem; }
    .download-btn { padding: 8px; border-radius: 50%; }
    .download-btn span { display: none; } /* Solo icono en movil para ahorrar espacio */
    .empty-state { padding: 3rem 1rem; }
    .empty-icon-wrapper { width: 60px; height: 60px; }
  }
</style>