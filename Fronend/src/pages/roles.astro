---
import Layout from '../layouts/Layout.astro';
// Se asume que este componente Layout proporciona la estructura base de la pรกgina.
---

<Layout title="Gestiรณn de Personal ">
ย ย {/* Alpine.js Data Store para manejar el estado de la tabla */}
ย ย <div x-data="rolesData" class="space-y-8 p-4 md:p-10 bg-blue-50/50 min-h-screen">
ย ย ย ย 
ย ย ย ย {/* ๐ข Notificaciรณn Superior (Simulada) */}
ย ย ย ย <div x-show="notification.show" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0" x-transition:leave-end="opacity-0 translate-y-2" class="fixed top-4 right-4 z-[60] p-4 rounded-xl shadow-2xl text-white font-semibold" :class="notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'">
ย ย ย ย ย ย <span x-text="notification.message"></span>
ย ย ย ย </div>

ย ย ย ย {/* ๐ฏ Encabezado Principal y Botรณn de Acciรณn */}
ย ย ย ย <header class="flex flex-col md:flex-row justify-between items-start md:items-center p-6 bg-white rounded-2xl shadow-xl border-l-4 border-blue-600">
ย ย ย ย ย ย <div class="mb-4 md:mb-0">
ย ย ย ย ย ย ย ย <h1 class="text-3xl font-extrabold text-blue-900 flex items-center space-x-3">
ย ย ย ย ย ย ย ย ย ย <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 21l-8 -4.5v-9l8 -4.5l8 4.5v9l-8 4.5"/><path d="M3.243 14.156l8.757 4.844l8.757 -4.844"/><path d="M12 12v6"/><path d="M12 12l-8 -4.5"/><path d="M12 12l8 -4.5"/><path d="M12 3l8 4.5"/></svg>
ย ย ย ย ย ย ย ย ย ย Personal de la Instituciรณn CBTA 71
ย ย ย ย ย ย ย ย </h1>
ย ย ย ย ย ย ย ย <p class="text-sm text-gray-500 mt-1">Gestiรณn de cuentas y asignaciรณn de roles clave.</p>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย {/* Botรณn "Nuevo Colaborador" (Verde Esmeralda) */}
ย ย ย ย ย ย <button 
ย ย ย ย ย ย ย ย @click="openPanelForAdd()"
ย ย ย ย ย ย ย ย class="w-full md:w-auto flex items-center justify-center space-x-2 px-6 py-2 bg-emerald-500 text-white font-bold rounded-full shadow-lg shadow-emerald-200 hover:bg-emerald-600 transition duration-300 transform hover:scale-[1.02]"
ย ย ย ย ย ย >
ย ย ย ย ย ย ย ย <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14"/><path d="M5 12l14 0"/></svg>
ย ย ย ย ย ย ย ย Nuevo Colaborador
ย ย ย ย ย ย </button>
ย ย ย ย </header>

ย ย ย ย {/* ๐ Filtros y Bรบsqueda (Barra de Control, mรกs limpia) */}
ย ย ย ย <section class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-4 bg-white p-4 rounded-xl shadow-md">
ย ย ย ย ย ย <div class="relative flex-1">
ย ย ย ย ย ย ย ย <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"/><path d="M21 21l-6 -6"/></svg>
ย ย ย ย ย ย ย ย <input 
ย ย ย ย ย ย ย ย ย ย x-model.debounce.300ms="searchText"
ย ย ย ย ย ย ย ย ย ย type="text" 
ย ย ย ย ย ย ย ย ย ย placeholder="Buscar personal por nombre, correo o ID..." 
ย ย ย ย ย ย ย ย ย ย class="w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm text-gray-700 transition"
ย ย ย ย ย ย ย ย />
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <select x-model="filterRole" class="px-4 py-2 border border-gray-200 rounded-lg focus:ring-blue-500 focus:border-blue-500 appearance-none bg-white text-sm text-gray-700 font-medium">
ย ย ย ย ย ย ย ย <option value="">๐ Ver Todos</option>
ย ย ย ย ย ย ย ย <option value="Administrador">๐ Administrador</option>
ย ย ย ย ย ย ย ย <option value="Caja">๐ฐ Personal de Caja</option>
ย ย ย ย ย ย ย ย <option value="Maestro">๐จโ๐ซ Maestro</option>
ย ย ย ย ย ย </select>
ย ย ย ย </section>

ย ย ย ย {/* ๐ Tabla de Roles/Usuarios (Mรกs limpia y estรฉtica) */}
ย ย ย ย <section class="bg-white p-6 rounded-2xl shadow-lg overflow-x-auto">
ย ย ย ย ย ย <table class="min-w-full divide-y divide-gray-100">
ย ย ย ย ย ย ย ย <thead class="bg-blue-50/70 border-b border-blue-200">
ย ย ย ย ย ย ย ย ย ย <tr>
ย ย ย ย ย ย ย ย ย ย ย ย <th class="px-4 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider w-1/12">ID</th>
ย ย ย ย ย ย ย ย ย ย ย ย <th class="px-4 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider w-3/12">Nombre de Usuario</th>
ย ย ย ย ย ย ย ย ย ย ย ย <th class="px-4 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider w-3/12">Email</th>
ย ย ย ย ย ย ย ย ย ย ย ย <th class="px-4 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider w-2/12">Rol Asignado</th>
ย ย ย ย ย ย ย ย ย ย ย ย <th class="px-4 py-3 text-left text-xs font-bold text-blue-700 uppercase tracking-wider w-1/12">Estado</th>
ย ย ย ย ย ย ย ย ย ย ย ย <th class="px-4 py-3 text-center text-xs font-bold text-blue-700 uppercase tracking-wider w-2/12">Acciones</th>
ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย </thead>
ย ย ย ย ย ย ย ย <tbody class="bg-white divide-y divide-gray-100">
ย ย ย ย ย ย ย ย ย ย <template x-for="user in filteredUsers" :key="user.id">
ย ย ย ย ย ย ย ย ย ย ย ย <tr class="hover:bg-blue-50/50 transition duration-150">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td x-text="user.id" class="px-4 py-3 whitespace-nowrap text-sm font-semibold text-gray-800"></td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 font-medium">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span x-text="user.username"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td x-text="user.email" class="px-4 py-3 whitespace-nowrap text-sm text-gray-500"></td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td class="px-4 py-3 whitespace-nowrap text-sm">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {/* Chips de Rol */}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span :class="{
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'bg-purple-100 text-purple-700 ring-purple-300': user.role === 'Administrador',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'bg-blue-100 text-blue-700 ring-blue-300': user.role === 'Caja',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'bg-yellow-100 text-yellow-700 ring-yellow-300': user.role === 'Maestro',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }" class="px-2 py-1 inline-flex text-xs leading-4 font-bold rounded-full border">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span x-text="user.role"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td class="px-4 py-3 whitespace-nowrap text-sm">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {/* Chips de Estado */}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span :class="{'bg-green-100 text-green-700 border-green-300': user.status === 'Activo', 'bg-red-100 text-red-700 border-red-300': user.status === 'Inactivo'}" class="px-2 py-1 inline-flex text-xs leading-4 font-bold rounded-full border">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span x-text="user.status"></span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย ย ย ย ย ย ย ย ย {/* Botones de acciรณn (รconos Limpios) */}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <td class="px-4 py-3 whitespace-nowrap text-center text-sm font-medium space-x-1.5">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {/* Botรณn Editar */}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button @click="openPanelForEdit(user)" title="Editar" class="text-blue-500 hover:text-blue-700 p-1.5 rounded-full hover:bg-blue-50 transition transform hover:scale-110">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1"/><path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.585 8.585v4h4l8.585 -8.585z"/></svg>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย {/* Botรณn Borrar */}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button @click="confirmDeleteUser(user.id, user.username)" title="Eliminar" class="text-red-500 hover:text-red-700 p-1.5 rounded-full hover:bg-red-50 transition transform hover:scale-110">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7l16 0"/><path d="M10 11l0 6"/><path d="M14 11l0 6"/><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"/><path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3"/></svg>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย ย ย </template>

ย ย ย ย ย ย ย ย ย ย {/* Mensaje de No Resultados */}
ย ย ย ย ย ย ย ย ย ย <tr x-show="filteredUsers.length === 0">
ย ย ย ย ย ย ย ย ย ย ย ย <td colspan="6" class="px-6 py-8 text-center text-lg text-gray-400 bg-gray-50/50 rounded-b-xl">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ๐คทโโ๏ธ No se encontraron usuarios que coincidan con los criterios.
ย ย ย ย ย ย ย ย ย ย ย ย </td>
ย ย ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย ย ย </tbody>
ย ย ย ย ย ย </table>
ย ย ย ย </section>


ย ย ย ย {/* ๐ก PANEL LATERAL (Off-Canvas) para Agregar/Editar */}
ย ย ย ย 
ย ย ย ย {/* Overlay de Fondo */}
ย ย ย ย <div x-show="isPanelOpen" x-transition.opacity.duration.300ms class="fixed inset-0 bg-blue-900 bg-opacity-30 backdrop-blur-sm z-40" @click="closePanel()"></div>
ย ย ย ย 
ย ย ย ย {/* Panel Deslizante (Estรฉtico) */}
ย ย ย ย <div x-show="isPanelOpen"
ย ย ย ย ย ย x-transition:enter="transition ease-out duration-300"
ย ย ย ย ย ย x-transition:enter-start="translate-x-full"
ย ย ย ย ย ย x-transition:enter-end="translate-x-0"
ย ย ย ย ย ย x-transition:leave="transition ease-in duration-300"
ย ย ย ย ย ย x-transition:leave-start="translate-x-0"
ย ย ย ย ย ย x-transition:leave-end="translate-x-full"
ย ย ย ย ย ย class="fixed top-0 right-0 w-full md:w-96 h-full bg-white shadow-2xl z-50 overflow-y-auto rounded-l-3xl"
ย ย ย ย >
ย ย ย ย ย ย <div class="p-8 h-full flex flex-col">
ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย ย ย {/* Tรญtulo del Panel */}
ย ย ย ย ย ย ย ย <div class="flex justify-between items-center pb-4 border-b-2 border-blue-100 mb-6">
ย ย ย ย ย ย ย ย ย ย <h3 class="text-2xl font-extrabold text-blue-800" x-text="isEditing ? 'โ๏ธ Editar Cuenta' : '๐ค Agregar Cuenta'"></h3>
ย ย ย ย ย ย ย ย ย ย <button @click="closePanel()" class="text-gray-400 hover:text-blue-700 transition p-1.5 rounded-full hover:bg-blue-50">
ย ย ย ย ย ย ย ย ย ย ย ย <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12"/><path d="M6 6l12 12"/></svg>
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย {/* Formulario (Acojedor) */}
ย ย ย ย ย ย ย ย <form @submit.prevent="saveUser()" class="space-y-5 flex-1 overflow-y-auto pr-2">
ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย <label for="username" class="block text-sm font-semibold text-gray-600">Nombre de Usuario</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input x-model="newUser.username" id="username" type="text" required class="mt-1 block w-full border border-gray-300 rounded-xl p-3 focus:ring-emerald-500 focus:border-emerald-500 text-sm shadow-sm transition">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย <label for="email" class="block text-sm font-semibold text-gray-600">Email Institucional</label>
ย ย ย ย ย ย ย ย ย ย ย ย <input x-model="newUser.email" id="email" type="email" required class="mt-1 block w-full border border-gray-300 rounded-xl p-3 focus:ring-emerald-500 focus:border-emerald-500 text-sm shadow-sm transition">
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย <label for="role" class="block text-sm font-semibold text-gray-600">Rol Asignado</label>
ย ย ย ย ย ย ย ย ย ย ย ย <select x-model="newUser.role" id="role" class="mt-1 block w-full border border-gray-300 rounded-xl p-3 focus:ring-emerald-500 focus:border-emerald-500 bg-white appearance-none text-sm shadow-sm transition">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Administrador">๐ Administrador</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Caja">๐ฐ Personal de Caja</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Maestro">๐จโ๐ซ Maestro</option>
ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div x-show="isEditing">
ย ย ย ย ย ย ย ย ย ย ย ย <label for="status" class="block text-sm font-semibold text-gray-600">Estado de la Cuenta</label>
ย ย ย ย ย ย ย ย ย ย ย ย <select x-model="newUser.status" id="status" class="mt-1 block w-full border border-gray-300 rounded-xl p-3 focus:ring-emerald-500 focus:border-emerald-500 bg-white appearance-none text-sm shadow-sm transition">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Activo">๐ข Activo</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Inactivo">๐ด Inactivo</option>
ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </form>
ย ย ย ย ย ย ย ย 
ย ย ย ย ย ย ย ย {/* Pie del Panel - Botones de Acciรณn */}
ย ย ย ย ย ย ย ย <div class="flex justify-between space-x-4 pt-6 mt-6 border-t border-gray-100">
ย ย ย ย ย ย ย ย ย ย <button @click.prevent="closePanel()" type="button" class="flex-1 py-2 text-sm font-bold text-gray-700 border border-gray-300 rounded-xl hover:bg-gray-100 transition shadow-sm">
ย ย ย ย ย ย ย ย ย ย ย ย Cancelar
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button @click.prevent="saveUser()" type="submit" class="flex-1 py-2 text-sm font-bold text-white bg-emerald-500 rounded-xl hover:bg-emerald-600 transition shadow-lg shadow-emerald-200">
ย ย ย ย ย ย ย ย ย ย ย ย <span x-text="isEditing ? 'โ Actualizar' : '๐ Registrar'"></span>
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>


ย ย ย ย {/* ๐๏ธ Modal de Confirmaciรณn de Borrado (Central) */}
ย ย ย ย <div x-show="isDeleting" x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 scale-90" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-90" class="fixed inset-0 bg-red-900 bg-opacity-30 backdrop-blur-sm flex items-center justify-center z-50 p-4">
ย ย ย ย ย ย <div @click.away="isDeleting = false" class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-8 space-y-6 transform transition-all border-t-6 border-red-500 text-center">
ย ย ย ย ย ย ย ย <svg class="mx-auto h-12 w-12 text-red-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 9v4"/><path d="M10 16h4"/><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"/></svg>
ย ย ย ย ย ย ย ย <h3 class="text-xl font-extrabold text-gray-800">Confirmar Eliminaciรณn</h3>
ย ย ย ย ย ย ย ย <p class="text-gray-600 text-sm">ยฟSeguro que deseas eliminar a <strong x-text="userToDeleteName"></strong> (ID <span x-text="userToDeleteId"></span>)?</p>
ย ย ย ย ย ย ย ย <div class="flex justify-center space-x-4 pt-2">
ย ย ย ย ย ย ย ย ย ย <button @click="isDeleting = false" type="button" class="flex-1 py-2 text-sm font-bold text-gray-700 border border-gray-300 rounded-xl hover:bg-gray-100 transition">
ย ย ย ย ย ย ย ย ย ย ย ย Cancelar
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button @click="deleteUser(userToDeleteId)" type="button" class="flex-1 py-2 text-sm font-bold text-white bg-red-500 rounded-xl hover:bg-red-600 transition shadow-md shadow-red-200">
ย ย ย ย ย ย ย ย ย ย ย ย Eliminar
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>
</Layout>

<script is:inline>
ย ย document.addEventListener('alpine:init', () => {
ย ย ย ย Alpine.data('rolesData', () => ({
ย ย ย ย ย ย // --- Estado de la aplicaciรณn ---
ย ย ย ย ย ย users: [
ย ย ย ย ย ย ย ย { id: 101, username: 'admin_sys', email: 'admin@cbta71.edu.mx', role: 'Administrador', status: 'Activo' },
ย ย ย ย ย ย ย ย { id: 105, username: 'martha_caja', email: 'martha@cbta71.edu.mx', role: 'Caja', status: 'Activo' },
ย ย ย ย ย ย ย ย { id: 110, username: 'pedro_maestro', email: 'pedro@cbta71.edu.mx', role: 'Maestro', status: 'Inactivo' },
ย ย ย ย ย ย ย ย { id: 115, username: 'luisa_caja', email: 'luisa@cbta71.edu.mx', role: 'Caja', status: 'Activo' },
ย ย ย ย ย ย ย ย { id: 120, username: 'ana_maestra', email: 'ana@cbta71.edu.mx', role: 'Maestro', status: 'Activo' },
ย ย ย ย ย ย ],
ย ย ย ย ย ย searchText: '',
ย ย ย ย ย ย filterRole: '',
ย ย ย ย ย ย isPanelOpen: false, 
ย ย ย ย ย ย isEditing: false, 
ย ย ย ย ย ย isDeleting: false, 
ย ย ย ย ย ย userToDeleteId: null,
ย ย ย ย ย ย userToDeleteName: '',
ย ย ย ย ย ย newUser: { id: null, username: '', email: '', role: 'Caja', status: 'Activo' },

ย ย ย ย ย ย // Objeto de Notificaciรณn
ย ย ย ย ย ย notification: { show: false, message: '', type: 'success' },

ย ย ย ย ย ย // Funciรณn para mostrar alertas temporales
ย ย ย ย ย ย showNotification(message, type = 'success') {
ย ย ย ย ย ย ย ย this.notification.message = message;
ย ย ย ย ย ย ย ย this.notification.type = type;
ย ย ย ย ย ย ย ย this.notification.show = true;
ย ย ย ย ย ย ย ย setTimeout(() => {
ย ย ย ย ย ย ย ย ย ย this.notification.show = false;
ย ย ย ย ย ย ย ย }, 4000);
ย ย ย ย ย ย },

ย ย ย ย ย ย // Computed Property para filtros y bรบsqueda
ย ย ย ย ย ย get filteredUsers() {
ย ย ย ย ย ย ย ย let filtered = this.users;
ย ย ย ย ย ย ย ย if (this.filterRole) {
ย ย ย ย ย ย ย ย ย ย filtered = filtered.filter(user => user.role === this.filterRole);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย if (this.searchText.length > 0) {
ย ย ย ย ย ย ย ย ย ย const searchLower = this.searchText.toLowerCase();
ย ย ย ย ย ย ย ย ย ย filtered = filtered.filter(user => 
ย ย ย ย ย ย ย ย ย ย ย ย user.username.toLowerCase().includes(searchLower) ||
ย ย ย ย ย ย ย ย ย ย ย ย user.email.toLowerCase().includes(searchLower) ||
ย ย ย ย ย ย ย ย ย ย ย ย user.id.toString().includes(searchLower)
ย ย ย ย ย ย ย ย ย ย );
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย return filtered;
ย ย ย ย ย ย },

ย ย ย ย ย ย // --- Funciones de Panel Lateral ---

ย ย ย ย ย ย closePanel() {
ย ย ย ย ย ย ย ย this.isPanelOpen = false;
ย ย ย ย ย ย ย ย this.isEditing = false;
ย ย ย ย ย ย ย ย this.newUser = { id: null, username: '', email: '', role: 'Caja', status: 'Activo' };
ย ย ย ย ย ย },

ย ย ย ย ย ย openPanelForAdd() {
ย ย ย ย ย ย ย ย this.isEditing = false;
ย ย ย ย ย ย ย ย this.newUser = { id: null, username: '', email: '', role: 'Caja', status: 'Activo' };
ย ย ย ย ย ย ย ย this.isPanelOpen = true;
ย ย ย ย ย ย },

ย ย ย ย ย ย openPanelForEdit(user) {
ย ย ย ย ย ย ย ย this.isEditing = true;
ย ย ย ย ย ย ย ย this.newUser = { ...user }; 
ย ย ย ย ย ย ย ย this.isPanelOpen = true;
ย ย ย ย ย ย },

ย ย ย ย ย ย // 1. Agregar/Actualizar Usuario
ย ย ย ย ย ย saveUser() {
ย ย ย ย ย ย ย ย let message = '';
ย ย ย ย ย ย ย ย if (this.isEditing) {
ย ย ย ย ย ย ย ย ย ย const index = this.users.findIndex(u => u.id === this.newUser.id);
ย ย ย ย ย ย ย ย ย ย if (index !== -1) {
ย ย ย ย ย ย ย ย ย ย ย ย this.users[index] = { ...this.newUser };
ย ย ย ย ย ย ย ย ย ย ย ย message = `Cuenta de ${this.newUser.username} actualizada con รฉxito.`;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย const maxId = this.users.length > 0 ? Math.max(...this.users.map(u => u.id)) : 100;
ย ย ย ย ย ย ย ย ย ย const newId = maxId + 1;
ย ย ย ย ย ย ย ย ย ย const newUserWithId = { ...this.newUser, id: newId };
ย ย ย ย ย ย ย ย ย ย this.users.push(newUserWithId);
ย ย ย ย ย ย ย ย ย ย message = `Nuevo colaborador ${newUserWithId.username} registrado.`;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย this.closePanel();
ย ย ย ย ย ย ย ย this.showNotification(message, 'success');
ย ย ย ย ย ย },

            // 2. Confirmar Borrado (Abre el modal de confirmaciรณn)
            confirmDeleteUser(id, username) {
                this.userToDeleteId = id;
                this.userToDeleteName = username;
                this.isDeleting = true;
            },

ย ย ย ย ย ย // 3. Borrar Usuario
ย ย ย ย ย ย deleteUser(id) {
                const username = this.userToDeleteName; 
ย ย ย ย ย ย ย ย this.users = this.users.filter(user => user.id !== id);
ย ย ย ย ย ย ย ย this.isDeleting = false; 
ย ย ย ย ย ย ย ย this.showNotification(`Cuenta de ${username} eliminada del sistema.`, 'error');
ย ย ย ย ย ย }
ย ย ย ย }));
ย ย });
</script>